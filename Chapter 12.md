12장 병렬성과 비동기성
===

### 경합 조건이란 무엇인가
- 경합 조건 : 2개(또는 그 이상)의 프로그램이 같은 자원에 동시에 접근하고, 자원 사용 순서에 따라 결과가 달라지는 경우

--- 

### 공유 자원
- 공유 자원 : 여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일 등을 말한다.
    - 공동으로 이용되기 때문에 누가 어떻게 데이터를 읽고, 쓰기에 따라 결과가 달라질 수 있다.
---

### 프로세스와 스레드
- 프로세스(Process) : 사용자 공간(User space)에서 실행되는 프로그램이다.
    - 자원을 공유하는 프로세스들은 어떤 방식으로든 서로 통신을 해야 한다.
    - 통신 방식의 예 : 프로그램에 코드형태로 들어간다. / 어떤 설정 정보를 통해서 정해진다.
    - 프로세스 마다 스택이 하나 존재한다.
- 프린트 서버(Print server) : 다음 문서의 도착과 상관없이 전체 문서를 출력할 수 있다.
- 스레드(Thread) : 정적인 데이터와 힙을 공유하지만 자체적으로 스택을 갖는 프로그램의 일부분을 말한다.
    - 경량 프로세스(Lightweight process)라고 부르기도 한다.
    - 사용자가 동시에 여러 문서를 여는 등의 작업이 가능하게 되어 보안 문제가 생긴다.
    - 한 탭에서 문제가 생기거나 버그가 발생하면 작업했던 내용을 잃어버릴 수 있다.
    - 어떤 스레드가 작업을 완료하는데 너무 오랜 시간이 걸리면 다른 모든 스레드가 실행되지 못해서 문제가 생길 수 있다.
- 스레드 스케줄러(Thread Scheduler) : 한 스레드에서 다른 스레드로 실행이 넘어갈 때 CPU 레지스터를 저장 하는 것이다.
---

## 락
- 어드바이저리 락(Advisory lock) : 코드에서 중요한 부분을 상호배제 메커니즘을 통해 원자적으로 처리하기 위한 프로그램이 충돌을 피하기 위해 따르는 것.
    - 락을 지킬지 안지킬지를 프로그램이 결정한다.
---

### 트랜잭션과 작업 크기
- 트랜잭션(transaction) : 각 연산을 독립적으로 수행하는 대신 원자적으로 실행되어야 하는 일련의 연산을 한꺼번에 묶어서 처리하는 것.
    - 성능을 향상할 가장 좋은 방법
- 엑스 윈도우 시스템(X window system) : 잘못 설계된 락의 예
    - 모든 락을 잠그는 것이 유일한 선택지인 경우가 가끔 있어서 동시성을 해치기 때문이다.
- 세밀하다(fine-grained) : 시스템에서 아주 작은 부분만 잠그는 락
    - 성기다(coarse-grained) : 더 큰 범위를 잠그는 락

---

### 락 대기
- 락을 기다리는 방법
    - 스핀(spin) : 락을 성공적으로 얻을 때 까지 락 획득을 반복 시도하는 것.
        1. 락을 요청하는 존재가 락 획득 요청을 락을 관리하는 쪽에 등록(register)한다.
        2. 요청이 받아들여졌을 때 통지(notify)를 받는다.
            - 규모를 쉽게 키우기 어렵다.
            - 인터넷 아키텍처에서 직접적으로 지원되지 않는다.
                - 필요하면 인터넷 위에 이런 방식을 구현할 수 있다.
    - 블로킹(blocking) : 시스템이 락을 할당할 수 있을 때까지 락을 요청한 프로그램을 일시중단(suspend)시키는 것.
    - 논블로킹(non-blocking) : 프로그램이 계속 실행되고 나중에 락을 얻었는지 여부를 어떤 방식으로든 통지받게 된다는 뜻이다.

---

### 교착 상태
- 교착 상태(deadlock) : 프로그램이 갖고 있는 락을 해제하는 지점으로 진행할 수 없는 것
- 원인
    - 아래 네 가지중 하나라도 없으면 교착 상태가 발생하지 않는다.
    1. 상호 배제 : 공유 자원을 함께 쓸 수 없어서 어느 한 프로세스가 독점적으로 사용해야만 한다.
    2. 점유 대기 : 프로세스들은 어느 자원을 점유한 상태에서 다른 자원을 요청한다.
    3. 비선점 : 프로세스가 할당받은 자원을 강제로 빼앗을 수 없다.
    4. 순환 대기 : 각 프로세스가 서로 순환적으로 다른 프로세스가 갖고 있는 자원을 요구한다.
- 방지 방법
    1. 자원을 상호 배제하지 않고 언제든 공유할 수 있는 자원으로 만든다.
    2. 어느 자원을 점유한 다음 다른 자원을 요구하지 않고 한꺼번에 자원을 요구한다.
    3. 선점형으로 바꾼다.
    4. 자원마다 우선순위를 부여해서 모든 프로세스가 다 서로 정해진 순서대로만 자원을 요구한다.

---

### 단기 락 구현
- 검사 후 설정(test and set) : 여러 프로세스가 락에 사용하기 위한것.
    - 원자적 명령어로, 어떤 메모리 위치에 들어 있는 값을 1로 설정하고, 원래 그 위치에 들어 있던 값을 돌려주는 것.
- 비교 후 바꾸기(compare and swap) : 락을 얻으려고 동시에 경합하는 프로세스가 아주 많을 때 사용한다.
    - 한 값만 설정하는 대신 명령어를 호출하는 쪽에서 예전 값과 새 값을 모두 제공하는 것.
- 위와 같은 명령어들은 시스템 모드에서만 사용하도록 제한된다.
    - 락에 다른 코드를 덧붙여서 더 효율적인 락을 구현할 수 있다.

---

### 장기 락 구현
- 장기 락 : 영구적인 저장소에 저장되어야 한다 → 여러 프로그램이 자원에 접근하면 안되는 경우
    - 시스템 콜 : 가장 먼저 요청한 프로세스가 성공하게 되는 프로그램이다.

---

### 브라우저 자바스크립트
- 자바스크립트 구현 : 사용자 이벤트에 응답하는 짧은 프로그램을 실행하기 위해 만들어졌기 때문에 이벤트 루프(event loop) 모델을 사용한다.
    - 단일 스레드 프로그램이다. 
    - 서버와의 상호작용이 동시에 이뤄진다.

---

### 비동기 함수와 프로미스
- 프로미스(promise) : 프로그래밍 언어를 더 복잡하게 만드는 대신 프로그래밍의 유형 중 일부를 편리하게 처리할 수 있게 해준다.
- 비동기 함수는 근본적으로 인터럽트할 수 없는 스레드이다.
